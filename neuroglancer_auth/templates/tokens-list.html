<html>
    <head>
        <base target="_blank">
        <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
        <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <style>
            body {
                max-width: 600px;
                margin: auto;
                padding: 20px;
                font-family: Roboto,sans-serif;
                -webkit-font-smoothing: antialiased;
                color: var(--mdc-theme-text-primary-on-background, rgba(0, 0, 0, 0.87));
                letter-spacing: var(--mdc-typography-body2-letter-spacing, 0.0178571429em);
            }

            .danger {
              --mdc-theme-primary: #B00020;
            }

            .mdc-list {
              border: 1px solid gray;
            }

            #tokensList .mdc-list-item {
              justify-content: space-between;
            }

            #createToken {
              margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
      
      <button id="createToken" class="mdc-button mdc-button--unelevated">
        <div class="mdc-button__ripple"></div>
        <span class="mdc-button__label">Create new token</span>
      </button>

      <ul id="tokensList" class="mdc-list">
      {% for token in tokens %}
      <li class="mdc-list-item" tabindex="0">
        <span class="mdc-list-item__ripple"></span>
        <span class="mdc-list-item__text">token: {{token.token}} - created: {{token.created.strftime('%Y-%m-%d')}}</span>
        <button data-token-id="{{token.id}}" class="deleteToken mdc-button mdc-button--unelevated danger">
            <div class="mdc-button__ripple"></div>
            <span class="mdc-button__label">Delete</span>
        </button>
      </li>
      {%- endfor %}
      </ul>
    </body>
    <script>
      const deleteButtons = document.querySelectorAll('#tokensList button.deleteToken');
      for (const deleteButton of deleteButtons) {
        deleteButton.addEventListener('click', async (el) => {
          const tokenId = parseInt(el.currentTarget.dataset.tokenId);

          const confirmRes = confirm(`Are you sure you want to delete this token?`);

          if (confirmRes) {
            const res = await fetch(`../api/v1/user/token/${tokenId}`, {
              method: 'DELETE',
              credentials: 'same-origin'
            });
            window.reload();
          }
        });
      }


      document.getElementById('createToken').addEventListener('click', async () => {
        const res = await fetch(`../api/v1/user/token`, {
          method: 'POST',
          credentials: 'same-origin'
        });

        window.reload();
      });

      const MDCRipple = mdc.ripple.MDCRipple;

      const button = new MDCRipple(document.querySelector('.mdc-button'));
      const MDCList = mdc.list.MDCList;
      const list = new MDCList(document.querySelector('.mdc-list'));
    </script>
</html>
