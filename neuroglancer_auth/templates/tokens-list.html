<html>
    <head>
        <base target="_blank">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

        <!-- Compiled and minified JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

        <style>
            body {
                max-width: 600px;
                margin: auto;
                padding: 20px;
                font-family: Roboto,sans-serif;
                -webkit-font-smoothing: antialiased;
                color: var(--mdc-theme-text-primary-on-background, rgba(0, 0, 0, 0.87));
                letter-spacing: var(--mdc-typography-body2-letter-spacing, 0.0178571429em);
            }



            #createToken {
              margin-bottom: 10px;
            }

            .collection .collection-item .secondary-content {
              position: absolute;
              top: 16px;
              right: 16px;
            }

            .collection .collection-item > *:first-child {
              font-size: larger;
            }
        </style>
    </head>
    <body>

      <button id="createToken" class="btn waves-effect waves-light" type="submit" name="action">Create new token</button>

      <ul id="tokensList" class="collection">
        {% for token in tokens %}
        <li class="collection-item">
          <div>token: {{token.token}}</div>
          <div class="grey-text text-darken-1">created: {{token.created.strftime('%Y-%m-%d')}}</div>
          <a class="deleteToken secondary-content waves-effect waves-light btn-small red darken-2">Delete</a>
        </li>
        {%- endfor %}
      </ul>
    </body>
    <script>
      const deleteButtons = document.querySelectorAll('#tokensList a.deleteToken');
      for (const deleteButton of deleteButtons) {
        deleteButton.addEventListener('click', async (el) => {
          const tokenId = parseInt(el.currentTarget.dataset.tokenId);

          const confirmRes = confirm(`Are you sure you want to delete this token?`);

          if (confirmRes) {
            const res = await fetch(`../api/v1/user/token/${tokenId}`, {
              method: 'DELETE',
              credentials: 'same-origin'
            });
            location.reload();
          }
        });
      }


      document.getElementById('createToken').addEventListener('click', async () => {
        const res = await fetch(`../api/v1/user/token`, {
          method: 'POST',
          credentials: 'same-origin'
        });

        location.reload();
      });
    </script>
</html>
